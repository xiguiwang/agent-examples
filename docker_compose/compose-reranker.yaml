services:
  vllm-reranker:
    container_name: vllm-reranker
    restart: always
    image: vllm-openai:vllm-cpu 
    ipc: host
    volumes:
      - "${HF_HOME}:/root/.cache/huggingface"
    environment:
      VLLM_DEVICE: "cpu"
      VLLM_USE_CPU_OPS: "1"
      VLLM_LOGGING_LEVEL: "DEBUG"
      no_proxy: ${no_proxy}
      http_proxy: ${http_proxy}
      https_proxy: ${https_proxy}
      HF_TOKEN: ${HF_TOKEN}
      HTTP_PROXY: ${http_proxy}
      HTTPS_PROXY: ${https_proxy}
      NO_PROXY: ${no_proxy}
      HF_HUB_OFFLINE: "1"
    deploy:
      resources:
        reservations:
          devices: []
    #command: ['--model', 'Qwen/Qwen3-Reranker-4B',  '--served-model-name', 'Qwen3-Reranker-4B',  '--gpu-memory-utilization', '0.90', '--hf_overrides','{"architectures": ["Qwen3ForSequenceClassification"],"classifier_from_token": ["no", "yes"],"is_original_qwen3_reranker": true}']
    command: [
        #'--model', 'BAAI/bge-reranker-base',  #'Qwen/Qwen3-Reranker-4B',  
        '--model', 'Qwen/Qwen3-Reranker-4B',  
        '--max-model-len', '16384',
        '--hf_overrides','{"architectures": ["Qwen3ForSequenceClassification"],"classifier_from_token": ["no", "yes"],"is_original_qwen3_reranker": true}'
    ]
    ports:
      - 8012:8000

networks:
  default:
    driver: bridge
